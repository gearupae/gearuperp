{% extends 'base.html' %}

{% block content %}
<div class="container" style="max-width: 500px;">
    <div class="text-center mb-4">
        <div class="bg-primary bg-opacity-10 rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width:80px;height:80px;">
            <i class="fas fa-box-open text-primary fa-2x"></i>
        </div>
        <h4 class="fw-bold">{{ title }}</h4>
        <p class="text-muted">Fill the form below to request consumables</p>
    </div>

    <div class="card">
        <div class="card-body p-4">
            <form method="post">
                {% csrf_token %}
                
                <div class="mb-4">
                    <label class="form-label fw-medium">
                        <i class="fas fa-box me-2 text-primary"></i>Consumable Item
                        <span class="text-danger">*</span>
                    </label>
                    {{ form.item }}
                    <div id="stockInfo" class="mt-2" style="display:none;">
                        <div id="stockAvailable" class="alert alert-success py-2 mb-0" style="display:none;">
                            <i class="fas fa-check-circle me-1"></i>
                            <span id="stockText"></span>
                        </div>
                        <div id="stockUnavailable" class="alert alert-warning py-2 mb-0" style="display:none;">
                            <i class="fas fa-exclamation-triangle me-1"></i>
                            <span id="noStockText">No stock available. Request will be pending approval.</span>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <label class="form-label fw-medium">
                        <i class="fas fa-hashtag me-2 text-primary"></i>Quantity Needed
                        <span class="text-danger">*</span>
                    </label>
                    {{ form.quantity }}
                </div>
                
                <div class="mb-4">
                    <label class="form-label fw-medium">
                        <i class="fas fa-sticky-note me-2 text-primary"></i>Notes
                        <span class="text-muted small">(Optional)</span>
                    </label>
                    {{ form.remarks }}
                </div>
                
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-paper-plane me-2"></i>Submit Request
                    </button>
                    <a href="{% url 'inventory:consumable_request_list' %}" class="btn btn-light">
                        Cancel
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const itemSelect = document.getElementById('id_item');
    const stockInfo = document.getElementById('stockInfo');
    const stockAvailable = document.getElementById('stockAvailable');
    const stockUnavailable = document.getElementById('stockUnavailable');
    const stockText = document.getElementById('stockText');
    
    // Stock data from server
    const stockData = {
        {% for item in items_with_stock %}
        {{ item.id }}: {{ item.total_stock|default:0 }},
        {% endfor %}
    };
    
    itemSelect.addEventListener('change', function() {
        const itemId = this.value;
        stockInfo.style.display = 'block';
        
        if (itemId && stockData[itemId] !== undefined) {
            const stock = stockData[itemId];
            if (stock > 0) {
                stockAvailable.style.display = 'block';
                stockUnavailable.style.display = 'none';
                stockText.textContent = `Available: ${stock} units in stock`;
            } else {
                stockAvailable.style.display = 'none';
                stockUnavailable.style.display = 'block';
            }
        } else if (itemId) {
            stockAvailable.style.display = 'none';
            stockUnavailable.style.display = 'block';
        } else {
            stockInfo.style.display = 'none';
        }
    });
});
</script>
{% endblock %}

