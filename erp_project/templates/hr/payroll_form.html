{% extends 'base.html' %}
{% block content %}
<div class="page-header">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-2">
            <li class="breadcrumb-item"><a href="{% url 'hr:payroll_list' %}">Payroll</a></li>
            <li class="breadcrumb-item active">{{ title }}</li>
        </ol>
    </nav>
    <h4 class="mb-0 fw-bold">{{ title }}</h4>
</div>

<form method="post">
    {% csrf_token %}
    {% if form.errors %}
    <div class="alert alert-danger">
        <strong>Please correct the following errors:</strong>
        <ul class="mb-0">
            {% for field, errors in form.errors.items %}
                {% for error in errors %}
                <li><strong>{{ field|title }}:</strong> {{ error }}</li>
                {% endfor %}
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    <div class="card mb-4">
        <div class="card-header"><h6 class="mb-0 fw-semibold">Payroll Details</h6></div>
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-6">
                    <label for="{{ form.employee.id_for_label }}" class="form-label">Employee <span class="text-danger">*</span></label>
                    {{ form.employee }}
                    {% if form.employee.errors %}<div class="text-danger small mt-1">{{ form.employee.errors|join:", " }}</div>{% endif %}
                </div>
                <div class="col-md-6">
                    <label for="{{ form.month.id_for_label }}" class="form-label">Month <span class="text-danger">*</span></label>
                    {{ form.month }}
                    {% if form.month.errors %}<div class="text-danger small mt-1">{{ form.month.errors|join:", " }}</div>{% endif %}
                </div>
                <div class="col-md-6">
                    <label for="{{ form.status.id_for_label }}" class="form-label">Status</label>
                    {{ form.status }}
                    {% if form.status.errors %}<div class="text-danger small mt-1">{{ form.status.errors|join:", " }}</div>{% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-header"><h6 class="mb-0 fw-semibold">Salary Breakdown</h6></div>
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-4">
                    <label for="{{ form.basic_salary.id_for_label }}" class="form-label">Basic Salary <span class="text-danger">*</span></label>
                    <div class="input-group">
                        <span class="input-group-text">AED</span>
                        {{ form.basic_salary }}
                    </div>
                    {% if form.basic_salary.errors %}<div class="text-danger small mt-1">{{ form.basic_salary.errors|join:", " }}</div>{% endif %}
                </div>
                <div class="col-md-4">
                    <label for="{{ form.allowances.id_for_label }}" class="form-label">Allowances</label>
                    <div class="input-group">
                        <span class="input-group-text">AED</span>
                        {{ form.allowances }}
                    </div>
                    {% if form.allowances.errors %}<div class="text-danger small mt-1">{{ form.allowances.errors|join:", " }}</div>{% endif %}
                </div>
                <div class="col-md-4">
                    <label for="{{ form.deductions.id_for_label }}" class="form-label">Deductions</label>
                    <div class="input-group">
                        <span class="input-group-text">AED</span>
                        {{ form.deductions }}
                    </div>
                    {% if form.deductions.errors %}<div class="text-danger small mt-1">{{ form.deductions.errors|join:", " }}</div>{% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <div class="card mb-4">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6 class="text-muted mb-2">Net Salary</h6>
                    <h4 class="mb-0 fw-bold" id="netSalary">AED 0.00</h4>
                    <small class="text-muted">Calculated automatically: Basic + Allowances - Deductions</small>
                </div>
            </div>
        </div>
    </div>
    
    <button type="submit" class="btn btn-primary"><i class="fas fa-save me-2"></i>Save</button>
    <a href="{% url 'hr:payroll_list' %}" class="btn btn-light">Cancel</a>
</form>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const basicSalary = document.getElementById('id_basic_salary');
    const allowances = document.getElementById('id_allowances');
    const deductions = document.getElementById('id_deductions');
    const netSalary = document.getElementById('netSalary');
    
    function calculateNetSalary() {
        const basic = parseFloat(basicSalary.value) || 0;
        const allow = parseFloat(allowances.value) || 0;
        const deduct = parseFloat(deductions.value) || 0;
        const net = basic + allow - deduct;
        netSalary.textContent = 'AED ' + net.toFixed(2);
    }
    
    if (basicSalary) basicSalary.addEventListener('input', calculateNetSalary);
    if (allowances) allowances.addEventListener('input', calculateNetSalary);
    if (deductions) deductions.addEventListener('input', calculateNetSalary);
    
    // Calculate on page load
    calculateNetSalary();
});
</script>
{% endblock %}


