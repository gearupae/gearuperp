{% extends 'base.html' %}

{% block content %}
<div class="page-header d-flex justify-content-between align-items-center">
    <div>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-2">
                <li class="breadcrumb-item"><a href="{% url 'finance:account_mapping_list' %}">Account Mapping</a></li>
                <li class="breadcrumb-item active">Settings</li>
            </ol>
        </nav>
        <h4 class="mb-0 fw-bold">{{ title }}</h4>
        <small class="text-muted">Global accounting configuration and auto-posting controls</small>
    </div>
</div>

<form method="post">
    {% csrf_token %}
    
    <div class="row">
        <div class="col-md-8">
            <!-- Auto-Post Settings -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold">
                        <i class="fas fa-bolt me-2 text-warning"></i>Auto-Post Journal Entries
                    </h6>
                    <small class="text-muted">SAP/Oracle Standard: Auto-post is enabled by default</small>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">
                        When enabled, journal entries are automatically posted to the ledger when documents are approved.
                        This is the industry standard behavior.
                    </p>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="auto_post_sales_invoice" 
                                       id="auto_post_sales_invoice" {% if settings.auto_post_sales_invoice %}checked{% endif %}>
                                <label class="form-check-label" for="auto_post_sales_invoice">
                                    <i class="fas fa-shopping-cart text-primary me-1"></i>Sales Invoices
                                </label>
                            </div>
                            <small class="text-muted ms-4">Post AR when invoice is approved</small>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="auto_post_vendor_bill" 
                                       id="auto_post_vendor_bill" {% if settings.auto_post_vendor_bill %}checked{% endif %}>
                                <label class="form-check-label" for="auto_post_vendor_bill">
                                    <i class="fas fa-truck text-primary me-1"></i>Vendor Bills
                                </label>
                            </div>
                            <small class="text-muted ms-4">Post AP when bill is approved</small>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="auto_post_expense_claim" 
                                       id="auto_post_expense_claim" {% if settings.auto_post_expense_claim %}checked{% endif %}>
                                <label class="form-check-label" for="auto_post_expense_claim">
                                    <i class="fas fa-receipt text-primary me-1"></i>Expense Claims
                                </label>
                            </div>
                            <small class="text-muted ms-4">Post Employee Payable on approval</small>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="auto_post_payroll" 
                                       id="auto_post_payroll" {% if settings.auto_post_payroll %}checked{% endif %}>
                                <label class="form-check-label" for="auto_post_payroll">
                                    <i class="fas fa-users text-primary me-1"></i>Payroll
                                </label>
                            </div>
                            <small class="text-muted ms-4">Post Salary Payable when processed</small>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="auto_post_payment" 
                                       id="auto_post_payment" {% if settings.auto_post_payment %}checked{% endif %}>
                                <label class="form-check-label" for="auto_post_payment">
                                    <i class="fas fa-money-bill text-primary me-1"></i>Payments
                                </label>
                            </div>
                            <small class="text-muted ms-4">Post when payment is confirmed</small>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" name="auto_post_bank_transfer" 
                                       id="auto_post_bank_transfer" {% if settings.auto_post_bank_transfer %}checked{% endif %}>
                                <label class="form-check-label" for="auto_post_bank_transfer">
                                    <i class="fas fa-exchange-alt text-primary me-1"></i>Bank Transfers
                                </label>
                            </div>
                            <small class="text-muted ms-4">Post when transfer is confirmed</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Posting Controls -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold">
                        <i class="fas fa-lock me-2 text-info"></i>Posting Controls
                    </h6>
                </div>
                <div class="card-body">
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" name="require_approval_before_posting" 
                               id="require_approval_before_posting" {% if settings.require_approval_before_posting %}checked{% endif %}>
                        <label class="form-check-label" for="require_approval_before_posting">
                            Require approval before posting
                        </label>
                        <br>
                        <small class="text-muted">Documents must be in "Approved" status before journal entries are created</small>
                    </div>
                    
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" name="allow_posting_to_closed_period" 
                               id="allow_posting_to_closed_period" {% if settings.allow_posting_to_closed_period %}checked{% endif %}>
                        <label class="form-check-label text-danger" for="allow_posting_to_closed_period">
                            <i class="fas fa-exclamation-triangle me-1"></i>Allow posting to closed periods
                        </label>
                        <br>
                        <small class="text-muted text-danger">NOT RECOMMENDED - violates audit controls</small>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4">
            <!-- VAT Settings -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold">
                        <i class="fas fa-percentage me-2 text-success"></i>VAT Settings (UAE)
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Default VAT Rate (%)</label>
                        <input type="number" step="0.01" name="default_vat_rate" class="form-control" 
                               value="{{ settings.default_vat_rate }}">
                        <small class="text-muted">UAE standard rate is 5%</small>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">VAT Registration Number (TRN)</label>
                        <input type="text" name="vat_registration_number" class="form-control" 
                               value="{{ settings.vat_registration_number }}"
                               placeholder="e.g., 100123456789003">
                    </div>
                </div>
            </div>
            
            <!-- Rounding -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold">
                        <i class="fas fa-calculator me-2 text-secondary"></i>Rounding
                    </h6>
                </div>
                <div class="card-body">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" name="round_to_fils" 
                               id="round_to_fils" {% if settings.round_to_fils %}checked{% endif %}>
                        <label class="form-check-label" for="round_to_fils">
                            Round to fils (2 decimals)
                        </label>
                    </div>
                    <small class="text-muted">UAE currency uses fils (0.01 AED)</small>
                </div>
            </div>
            
            <!-- Info Card -->
            <div class="card border-0 shadow-sm bg-light">
                <div class="card-header bg-white py-3">
                    <h6 class="mb-0 fw-bold">
                        <i class="fas fa-info-circle me-2 text-info"></i>SAP/Oracle Standard
                    </h6>
                </div>
                <div class="card-body small">
                    <ul class="mb-0 ps-3">
                        <li class="mb-2">Auto-posting should be <strong>ON</strong> by default</li>
                        <li class="mb-2">Draft documents should <strong>NOT</strong> affect the ledger</li>
                        <li class="mb-2">Posting happens on <strong>Approval</strong>, not on Payment</li>
                        <li>Payment creates a <strong>separate clearing entry</strong></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card border-0 shadow-sm">
        <div class="card-body">
            <button type="submit" class="btn btn-dark">
                <i class="fas fa-save me-2"></i>Save Settings
            </button>
            <a href="{% url 'finance:account_mapping_list' %}" class="btn btn-light">Cancel</a>
        </div>
    </div>
</form>
{% endblock %}


